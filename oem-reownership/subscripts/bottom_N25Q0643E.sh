#TODO: change script to not depend on ifdtool, considering x230-libremkey would produce 12Mb image splitted in 4Mb and 8Mb image with shrinked IFD and ME taken from blob directory
echo "Backuping bottom N25Q064..3E SPI flash into bottom.rom" && sudo flashrom -r ./bottom.rom --programmer ch341a_spi -c "N25Q064..3E" && echo "Verifying bottom N25Q064..3E SPI flash" && sudo flashrom -v ./bottom.rom --programmer ch341a_spi -c "N25Q064..3E" && echo "Unlocking ROM descriptor..." && /home/user/heads/build/coreboot-4.8.1/util/ifdtool/ifdtool -u ./bottom.rom && echo "Neutering+Deactivating ME" && python /home/user/me_cleaner/me_cleaner.py -r -t -d -S -O ./cleaned_me.rom ./bottom.rom.new --extract-me ./extracted_me.rom && echo "Flashing back Neutered+Deactivated ME in bottom N25Q064..3E SPI flash chip..." && sudo flashrom -w ./cleaned_me.rom --programmer ch341a_spi -c "N25Q064..3E"
